# Cursor Rule: Project Style Guide Enforcement

This file contains machine-readable rules derived from `memory-bank/style-guide.md` to guide Cursor agents and automated validators.

---

id: style-guide
title: "Project Style Guide Enforcement"
source: "memory-bank/style-guide.md"
description: "Machine-readable enforcement rules derived from the canonical project style guide. Agents should consult this rule file before proposing edits that affect workflows, branches, or repository policies."

rules:
  - id: require_style_reference
    name: "Require style guide reference in PR/commit"
    when: "changes affect workflows, docs, CONTRIBUTING.md, or memory-bank/*"
    check: "pr_body_or_commit_message_contains"
    pattern: "memory-bank/style-guide.md|CONTRIBUTING.md"
    message: "Include a short reference to `memory-bank/style-guide.md` (or `CONTRIBUTING.md`) in the PR body or commit message when changing workflows, docs, or project policies."
    severity: "warning"

  - id: forbid_direct_main_push
    name: "No direct pushes to main"
    when: "push_to_branch == main"
    check: "prevent_direct_push"
    message: "Direct pushes to `main` are prohibited. Use the PR flow (target `develop`/`staging`, or `main` only for release PRs)."
    severity: "error"

  - id: require_codeowners_review_for_infra
    name: "Require CODEOWNERS review for infra and workflows"
    paths:
      - ".github/**"
      - ".github/workflows/**"
      - "frontend/playwright.config.ts"
      - "memory-bank/implementation/**"
    check: "require_review_by_codeowners"
    message: "Changes to CI/workflows or infra must have a CODEOWNERS review before merging."
    severity: "error"

  - id: enforce_branch_naming
    name: "Enforce branch naming conventions"
    check: "branch_name_matches"
    pattern: "^(feature|bugfix|hotfix|release)\/.+"
    message: "Branch name must follow `feature/<desc>`, `bugfix/<desc>`, `hotfix/<desc>`, or `release/vX.Y.Z`."
    severity: "warning"

  - id: require_precommit_and_ci_checks
    name: "Require style validator locally and in CI"
    check: "ci_job_required"
    job_name: "style-check"
    message: "A CI job named `style-check` that runs the style validator must be present on PRs; pre-commit hooks should run the same validator locally."
    severity: "error"

  - id: docs_update_on_release_changes
    name: "Update DEPLOYMENT.md on release-related changes"
    when: "changes affect deployment or release files (next.config.ts, deployment scripts, env docs)"
    check: "pr_body_contains_docs_update"
    message: "If you change deployment or release flow, add a short note and update `DEPLOYMENT.md` and reference `memory-bank/style-guide.md` where appropriate."
    severity: "warning"

---

usage:
  agent_instructions:
    - "Always read `memory-bank/style-guide.md` before proposing edits that affect project workflow, branching, CI, or deployment."
    - "When proposing workflow or branch policy edits, include a one-line justification and link to `CONTRIBUTING.md` or `memory-bank/style-guide.md` in the PR body."
    - "Do not push directly to `main`; create a branch following the naming convention and open a PR targeting `develop` or `staging` as appropriate."
    - "For infra and CI changes, request review from CODEOWNERS and ensure the `style-check` CI job passes."

verifier_integration_instructions:
  - "Validator scripts (e.g., `scripts/validate_agent_output.py`) should load this file and implement the listed checks."
  - "CI job `style-check` should run the validator and fail the job on severity `error` violations."

notes:
  - "This rule file is intended to be consumed by both human reviewers and automated validators (agents). Keep it synchronized with `memory-bank/style-guide.md`."
description:
globs:
alwaysApply: true
---
